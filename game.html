<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>Game</title>

<!-- CSS -->
	<style type="text/css">
		body {
			background-color: #000;
			overflow: hidden; /*  Disable scrollbars */
			display: block;	/* No floating content on sides, makes the canvas act like a <div> as opposed to a <span> */
		}

		#gameCanvas {
			position: absolute;
			margin-left: 15%;
/*			min-width: 400px;*/
		}

		h1 {
			font-family: Georgia;
			font-size: 6rem;
			color: #FaFaFa;
			text-align: center;
		}

	</style>

<!-- JavaScript -->
	<script>
		//the background - a place for drawings
		var canvas;	
		var canvasContext;

		//window size
		// var w = window.innerWidth;
		// var h = window.innerHeight;
				
		//położenie i jego zmiany dla piłki
		ballRadius = 20;
		var ballX = 50; //piłka w osi X
		var ballY = 50;
		var ballSpeedX = 10; //o ile pikseli ma przeskakiwać
		var ballSpeedY = 10;

		//położenie i jego zmiany dla prostokątów
		var paddle1Y = 250;
		var paddle2Y = 300; // będzie automatycznie
		const paddleHeight = 100;
		const paddleThickness = 10;

		//wyniki
		var player1Score = 0;
		var player2Score = 0;
		const winningScore = 5; //constant winning condition
 		var showingWinScreen = false;

		function drawCircle(centerX, centerY, radius, circleColor){
			//rysowanie piłki
			canvasContext.fillStyle = circleColor;
			canvasContext.beginPath();
			canvasContext.arc(centerX, centerY, radius, 0, Math.PI*2, false); //false - drawing clockwise or not
			canvasContext.fill();
		}

		function drawRect(leftX, topY, width, height, rectColor) {
			canvasContext.fillStyle = rectColor;
			canvasContext.fillRect(leftX, topY, width, height);
		}

		//funkcja wpływu ruchu myszką na położenie prostokątów
		function calculateMousePos(evt) {	//evt - event data
			var rect = canvas.getBoundingClientRect();
			var root = document.documentElement;
			var mouseX = evt.clientX - rect.left - root.scrollLeft;
			var mouseY = evt.clientY - rect.top - root.scrollTop;
			return {
				x:mouseX,
				y:mouseY
			};
		}

		//funkcja kliknięcia myszki po zakończonej grze
		function handleMouseClick(evt) {
			if(showingWinScreen) {
				player1Score = 0;
				player2Score = 0;
				showingWinScreen = false;
			}
		}

		//resizing gameCanvas function
		function resizeCanvas() {
			canvas.width = window.innerWidth*0.7;
			canvas.height = window.innerHeight*0.7;
			// canvas.style.marginLeft = 300;			//nie działa
			// canvas.style.position = "absolute";;
		}


// //odliczanie - do napisania
// function countdown() {
// 	canvasContext.fillText("1");
// }

		//funkcja resetująca ustawienie piłki
		function ballReset() {
			//reset punktów po wygranej
			if(player1Score >= winningScore || player2Score >= winningScore) {
				showingWinScreen = true;
			}

			ballSpeedX = -ballSpeedX;
			ballX = canvas.width/2;
			ballY = canvas.height/2;
		}

		//rysowanie linii na środku
		function drawNet() {
			for(var i = 0; i < canvas.height; i += 50){
				drawRect(canvas.width/2-1, i, 2, 35, "white");
			}
		}

		//ruchy prawego prostokąta - komputer
		function computerMovement() {
			var paddle2YCenter = paddle2Y + (paddleHeight/2);
			if(paddle2YCenter < ballY-30) {		//30px zapasu od środka w każdą stronę
				paddle2Y += 8; // = paddle2Y + 8
			} else if(paddle2YCenter > ballY+30) {
				paddle2Y -= 8;
			}
		}

		function moveEverything() {
			//zatrzymanie gry gdy ktoś wygra
			if(showingWinScreen) {
				return;
			}

			//ruch prawego prostokąta
			computerMovement();

			//ruch piłki
			ballX = ballX + ballSpeedX;
			
			//przekroczenie lewej granicy
			if(ballX <= paddleThickness*3 + ballRadius){
				if(ballY > paddle1Y && ballY < paddle1Y + paddleHeight){
					ballSpeedX = - ballSpeedX;

				//zmiana kąta odbicia w zależności, gdzie uderzy piłka
					var deltaY = ballY - (paddle1Y + paddleHeight/2);
					ballSpeedY = deltaY * 0.3;

				} else {
					player2Score++;		//musi być przed resetem, żeby podjąć decyzję o wygraniu
					ballReset();
				}
			}

			//przekroczenie prawej granicy
			if(ballX > canvas.width - ballRadius - paddleThickness*4){
				if(ballY > paddle2Y && ballY < paddle2Y+paddleHeight){
					ballSpeedX = - ballSpeedX;
				//zmiana kąta odbicia w zależności, gdzie uderzy piłka
					var deltaY = ballY - (paddle2Y + paddleHeight/2);
					ballSpeedY = deltaY * 0.3;
				} else {
					player1Score++;
					ballReset();					
				}
			}

			
			//przekroczenie górnej i dolnej granicy
			ballY = ballY + ballSpeedY;
			if(ballY + ballRadius >= canvas.height || ballY - ballRadius <= 0){
				ballSpeedY = - ballSpeedY;
			}
		}		

		function drawEverything() {
			//rysowanie tła
			//drawRect(0, 0, canvas.width, canvas.height, "black"); //0,0 współrzędne lewego górnego wierzchołka
			canvasContext.fillStyle = "black";
			canvasContext.fillRect(0, 0, canvas.width, canvas.height);

			//stroke
			canvasContext.strokeStyle = "#F10000";
			canvasContext.lineWidth = 5;
			canvasContext.strokeRect(0, 0, canvas.width, canvas.height);

			//kliknij by kontynuować po wygranej
			if(showingWinScreen) {
				canvasContext.font = "30px Georgia";
				canvasContext.fillStyle = "white";
				
				if(player1Score >= winningScore){
					canvasContext.fillText("You won!", 360, 100);
				} else if (player2Score >= winningScore) {
					canvasContext.fillText("You lost!", 360, 100);
				}

				canvasContext.fillText("Click to continue", 300, 200);
				return;
		}

			//rysowanie linii na środku
			//drawRect(canvas.width/2-2.5, 0, 5, canvas.height, "white");
			drawNet();
			
			//przywołanie funkcji rysującej piłkę
			drawCircle(ballX, ballY, ballRadius, "white");			

			//lewy prostokąt
			drawRect(paddleThickness*2, paddle1Y, paddleThickness, paddleHeight, "purple"); 
			drawCircle(paddleThickness*2.5, paddle1Y, paddleThickness/2, "purple"); 
			drawCircle(paddleThickness*2.5, paddle1Y + paddleHeight, paddleThickness/2, "purple");
			
			//prawy prostokąt
			drawRect(canvas.width - paddleThickness*3, paddle2Y, paddleThickness, paddleHeight, "purple"); 
			drawCircle(canvas.width - paddleThickness*2.5, paddle2Y, paddleThickness/2, "purple"); 
			drawCircle(canvas.width - paddleThickness*2.5, paddle2Y + paddleHeight, paddleThickness/2, "purple")

			//tablica wyników
			canvasContext.font = "30px Georgia";
			canvasContext.fillStyle = "white";
			canvasContext.fillText(player1Score, canvas.width/2-70, 50);
			canvasContext.fillText(player2Score, canvas.width/2+50, 50);
		}


		//główna funkcja, zbiorcza
		window.onload = function() {
			
			canvas = document.getElementById("gameCanvas");
			canvasContext = canvas.getContext("2d");	

			//drawing canvas function
			function drawCanvas() {
				canvas.width = window.innerWidth*0.7;
				canvas.height = window.innerHeight*0.7;
				// canvas.style.marginLeft = 300;			//nie działa
    //      		canvas.style.position = "absolute";
			}		
			
			//resposivity function
			resize();
			function resize() {
				window.addEventListener("resize", resizeCanvas, false);
				drawCanvas();
			}		

			var framesPerSecond = 30; 
			setInterval(function(){
				moveEverything(); 
				drawEverything();
			}, 1000/framesPerSecond);

			//mouseclick
			canvas.addEventListener("mousedown", handleMouseClick);

			//mousemovements for left paddle
			canvas.addEventListener("mousemove",
				function(evt){
					var mousePos = calculateMousePos(evt);
					paddle1Y = mousePos.y - (paddleHeight/2);
				})
		}

	</script>
</head>

<!-- HTML -->
<body>
	<h1>PADDLES GAME</h1>

	<canvas id="gameCanvas"></canvas>

</body>
</html>
